<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>@thecricsters - Join us on Telegram</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://content.jwplatform.com/libraries/SAHhwvZq.js"></script>
  <style>
    #message, .telegram-toggle {
      color: #fff;
      align-items: center;
      z-index: 1001;
      display: flex;
      position: fixed;
    }

    body {
      margin: 0;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background-color: #f4f4f4;
      overflow: hidden;
    }

    .jwplayer {
      position: absolute !important;
    }

    .telegram-toggle {
      top: 10px;
      right: 10px;
      background-color: #08c;
      padding: 10px 15px;
      border-radius: 50px;
      font-weight: 700;
    }

    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #1c1c1c;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 0 15px rgba(255, 255, 255, .2);
      z-index: 1002;
      width: 90%;
      max-width: 400px;
      animation: .5s fadeIn;
    }

    .popup h2 {
      color: #fc0;
      margin-bottom: 10px;
      font-size: 20px;
    }

    .popup button {
      background-color: #08c;
      color: #fff;
      border: none;
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color .3s;
      margin-bottom: 10px;
      width: 100%;
    }

    .popup button:hover {
      background-color: #069;
    }

    @keyframes fadeIn {
      from {
        opacity: 0
      }

      to {
        opacity: 1
      }
    }
  </style>
</head>

<body>
  <div id="jwplayerDiv"></div>

  <script>
    let cachedConfig = null;

    function getParameterByName(paramName, url = window.location.href) {
      const regex = new RegExp('[?&]' + paramName.replace(/[\[\]]/g, '\\$&') + '(=([^&#]*)|&|#|$)');
      const results = regex.exec(url);
      return results ? decodeURIComponent(results[2]?.replace(/\+/g, ' ') || '') : null;
    }

    async function fetchConfig(id) {
      if (cachedConfig) return cachedConfig;

      try {
        const response = await fetch(`https://service.cricsters.io/main?id=${id}`);
        if (!response.ok) throw new Error('Network response was not ok');
        
        const encryptedData = await response.text();
        const decryptedData = decryptResponse(encryptedData);
        const config = JSON.parse(decryptedData);

        if (config.error === 'ID not found') {
          window.location.href = '';
          return null;
        }

        cachedConfig = config;
        return config;
      } catch (error) {
        console.error('Error fetching configuration:', error);
        return null;
      }
    }

    function decryptResponse(encryptedData) {
      const key = '$E*^@k];]G6STLZ3Mqh]S9R"6rm(1wPK1=QP9_uwOIn>~m[JfN/:7_Z$flq[+Hx';
      const decodedData = atob(encryptedData);
      let decrypted = '';

      for (let i = 0; i < decodedData.length; i++) {
        decrypted += String.fromCharCode(
          decodedData.charCodeAt(i) ^ key.charCodeAt(i % key.length)
        );
      }

      return decrypted;
    }

    function extractTokenFromLink(url) {
      const matches = url.match(/__hdnea__=([^&]+)/);
      return matches ? matches[1] : '';
    }

    let networkIntercepted = false;

    function interceptNetworkRequests(authToken, hdneaToken) {
      if (networkIntercepted) return;
      networkIntercepted = true;

      const originalOpen = XMLHttpRequest.prototype.open;

      XMLHttpRequest.prototype.open = function (method, url) {
        let modifiedUrl = url;

        if (url.startsWith('https://tv.media.jio.com/')) {
          modifiedUrl = url.replace('tv.media.jio.com', 'jiotv.drmlive.au');
        } else if (url.startsWith('https://tataplaymt.slivcdn.com/')) {
          modifiedUrl = url.replace('tataplaymt.slivcdn.com', 'sony.cricsterspkl.io/sony.php');
        }

        if ((url.includes('.mpd') || url.includes('.m3u8')) && hdneaToken && !url.includes('__hdnea__=')) {
          modifiedUrl += (url.includes('?') ? '&' : '?') + `__hdnea__=${hdneaToken}`;
        }

        originalOpen.call(this, method, modifiedUrl);

        if (authToken) {
          this.setRequestHeader('Authorization', `Bearer ${authToken}`);
        }
      };
    }

    async function playVideo() {
      const id = getParameterByName('id');
      if (!id) {
        console.error('No ID parameter found in the URL.');
        return;
      }

      const config = await fetchConfig(id);
      if (!config) {
        console.error('No configuration found for ID:', id);
        return;
      }

      const streamUrl = config.url;
      const bearerToken = config.Bearer;
      const hdneaToken = extractTokenFromLink(streamUrl);

      interceptNetworkRequests(bearerToken, hdneaToken);

      const player = jwplayer('jwplayerDiv');
      const source = {
        file: streamUrl,
        default: true,
        type: streamUrl.endsWith('.mpd') ? 'dash' : 'hls'
      };

      const playerConfig = {
        playlist: [{ sources: [source] }],
        width: '100%',
        aspectratio: '16:9',
        autostart: true
      };

      if (config.k1 && config.k2) {
        playerConfig.drm = {
          clearkey: {
            keyId: config.k1,
            key: config.k2
          }
        };
      }

      player.setup(playerConfig);
    }

    window.onload = playVideo;
  </script>

  <script defer src="https://static.cloudflareinsights.com/beacon.min.js"
    integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ=="
    data-cf-beacon='{"rayId":"912ed4b19f886047","version":"2025.1.0","r":1,"token":"2d99084568e84a00ac8d93c619dbf0f8"}'
    crossorigin="anonymous"></script>
</body>

</html>
